"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9492],{5286:(st,Q,w)=>{w.r(Q),w.d(Q,{Headers:()=>ae,Request:()=>Y,Response:()=>le,default:()=>oe,fetch:()=>ie});var $=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}();const ie=$.fetch,oe=$.fetch.bind($),ae=$.Headers,Y=$.Request,le=$.Response},9492:(st,Q,w)=>{w.d(Q,{UU:()=>Lr});class $ extends Error{constructor(r,e="FunctionsError",t){super(r),this.name=e,this.context=t}}class ie extends ${constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class oe extends ${constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class ae extends ${constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var Y=function(i){return i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2",i}(Y||{});class it{constructor(r,{headers:e={},customFetch:t,region:n=Y.Any}={}){this.url=r,this.headers=e,this.region=n,this.fetch=(i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(w.bind(w,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)})(t)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,e={}){var t;return function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(c){try{u(t.next(c))}catch(d){o(d)}}function l(c){try{u(t.throw(c))}catch(d){o(d)}}function u(c){c.done?s(c.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(c.value).then(a,l)}u((t=t.apply(i,r||[])).next())})}(this,void 0,void 0,function*(){try{const{headers:n,method:s,body:o}=e;let u,a={},{region:l}=e;l||(l=this.region),l&&"any"!==l&&(a["x-region"]=l),o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=o):"string"==typeof o?(a["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(a["Content-Type"]="application/json",u=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${r}`,{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:u}).catch(p=>{throw new ie(p)}),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new oe(c);if(!c.ok)throw new ae(c);let g,f=(null!==(t=c.headers.get("Content-Type"))&&void 0!==t?t:"text/plain").split(";")[0].trim();return g="application/json"===f?yield c.json():"application/octet-stream"===f?yield c.blob():"multipart/form-data"===f?yield c.formData():yield c.text(),{data:g,error:null}}catch(n){return{data:null,error:n}}})}}var h=w(467),ce=w(5286);class ot extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}class at{constructor(r){this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=r.headers,this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=r.shouldThrowOnError,this.signal=r.signal,this.isMaybeSingle=r.isMaybeSingle,this.fetch=r.fetch?r.fetch:typeof fetch>"u"?ce.default:fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(r,e){var t=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(function(){var o=(0,h.A)(function*(a){var l,u,c;let d=null,f=null,g=null,p=a.status,_=a.statusText;if(a.ok){if("HEAD"!==t.method){const O=yield a.text();""===O||(f="text/csv"===t.headers.Accept||t.headers.Accept&&t.headers.Accept.includes("application/vnd.pgrst.plan+text")?O:JSON.parse(O))}const A=null===(l=t.headers.Prefer)||void 0===l?void 0:l.match(/count=(exact|planned|estimated)/),S=null===(u=a.headers.get("content-range"))||void 0===u?void 0:u.split("/");A&&S&&S.length>1&&(g=parseInt(S[1])),t.isMaybeSingle&&"GET"===t.method&&Array.isArray(f)&&(f.length>1?(d={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,g=null,p=406,_="Not Acceptable"):f=1===f.length?f[0]:null)}else{const A=yield a.text();try{d=JSON.parse(A),Array.isArray(d)&&404===a.status&&(f=[],d=null,p=200,_="OK")}catch{404===a.status&&""===A?(p=204,_="No Content"):d={message:A}}if(d&&t.isMaybeSingle&&!(null===(c=null==d?void 0:d.details)||void 0===c)&&c.includes("0 rows")&&(d=null,p=200,_="OK"),d&&t.shouldThrowOnError)throw new ot(d)}return{error:d,data:f,count:g,status:p,statusText:_}});return function(a){return o.apply(this,arguments)}}());return this.shouldThrowOnError||(s=s.catch(o=>{var a,l,u;return{error:{message:`${null!==(a=null==o?void 0:o.name)&&void 0!==a?a:"FetchError"}: ${null==o?void 0:o.message}`,details:`${null!==(l=null==o?void 0:o.stack)&&void 0!==l?l:""}`,hint:"",code:`${null!==(u=null==o?void 0:o.code)&&void 0!==u?u:""}`},data:null,count:null,status:0,statusText:""}})),s.then(r,e)}}class lt extends at{select(r){let e=!1;const t=(null!=r?r:"*").split("").map(n=>/\s/.test(n)&&!e?"":('"'===n&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:n,referencedTable:s=n}={}){const o=s?`${s}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${r}.${e?"asc":"desc"}${void 0===t?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e,referencedTable:t=e}={}){return this.url.searchParams.set(typeof t>"u"?"limit":`${t}.limit`,`${r}`),this}range(r,e,{foreignTable:t,referencedTable:n=t}={}){const o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(typeof n>"u"?"offset":`${n}.offset`,`${r}`),this.url.searchParams.set(o,""+(e-r+1)),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="GET"===this.method?"application/json":"application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:s=!1,format:o="text"}={}){var a;const l=[r?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),u=null!==(a=this.headers.Accept)&&void 0!==a?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${l};`,this}rollback(){var r;return(null!==(r=this.headers.Prefer)&&void 0!==r?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class F extends lt{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}in(r,e){const t=Array.from(new Set(e)).map(n=>"string"==typeof n&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}contains(r,e){return"string"==typeof e?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return"string"==typeof e?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return this.url.searchParams.append(r,"string"==typeof e?`ov.${e}`:`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:n}={}){let s="";return"plain"===n?s="pl":"phrase"===n?s="ph":"websearch"===n&&(s="w"),this.url.searchParams.append(r,`${s}fts${void 0===t?"":`(${t})`}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e,referencedTable:t=e}={}){return this.url.searchParams.append(t?`${t}.or`:"or",`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}}class ct{constructor(r,{headers:e={},schema:t,fetch:n}){this.url=r,this.headers=e,this.schema=t,this.fetch=n}select(r,{head:e=!1,count:t}={}){const n=e?"HEAD":"GET";let s=!1;const o=(null!=r?r:"*").split("").map(a=>/\s/.test(a)&&!s?"":('"'===a&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),t&&(this.headers.Prefer=`count=${t}`),new F({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:e,defaultToNull:t=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),e&&s.push(`count=${e}`),t||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(r)){const o=r.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new F({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:s=!0}={}){const a=[`resolution=${t?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),n&&a.push(`count=${n}`),s||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(r)){const l=r.reduce((u,c)=>u.concat(Object.keys(c)),[]);if(l.length>0){const u=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",u.join(","))}}return new F({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:e}={}){const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),e&&n.push(`count=${e}`),this.headers.Prefer=n.join(","),new F({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const t=[];return r&&t.push(`count=${r}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new F({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const ut={"X-Client-Info":"postgrest-js/1.15.0"};class ue{constructor(r,{headers:e={},schema:t,fetch:n}={}){this.url=r,this.headers=Object.assign(Object.assign({},ut),e),this.schemaName=t,this.fetch=n}from(r){const e=new URL(`${this.url}/${r}`);return new ct(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new ue(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,e={},{head:t=!1,get:n=!1,count:s}={}){let o;const a=new URL(`${this.url}/rpc/${r}`);let l;t?(o="HEAD",Object.entries(e).forEach(([c,d])=>{a.searchParams.append(c,`${d}`)})):n?(o="GET",Object.entries(e).forEach(([c,d])=>{a.searchParams.append(c,`${d}`)})):(o="POST",l=e);const u=Object.assign({},this.headers);return s&&(u.Prefer=`count=${s}`),new F({method:o,url:a,headers:u,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}const ht={"X-Client-Info":"realtime-js/2.9.3"};var K=function(i){return i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed",i}(K||{}),x=function(i){return i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving",i}(x||{}),P=function(i){return i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token",i}(P||{}),Ie=function(i){return i.websocket="websocket",i}(Ie||{}),q=function(i){return i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed",i}(q||{});class Le{constructor(r,e){this.callback=r,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class pt{constructor(){this.HEADER_LENGTH=1}decode(r,e){return r.constructor===ArrayBuffer?e(this._binaryDecode(r)):e("string"==typeof r?JSON.parse(r):{})}_binaryDecode(r){const e=new DataView(r),t=new TextDecoder;return this._decodeBroadcast(r,e,t)}_decodeBroadcast(r,e,t){const n=e.getUint8(1),s=e.getUint8(2);let o=this.HEADER_LENGTH+2;const a=t.decode(r.slice(o,o+n));o+=n;const l=t.decode(r.slice(o,o+s));return o+=s,{ref:null,topic:a,event:l,payload:JSON.parse(t.decode(r.slice(o,r.byteLength)))}}}class he{constructor(r,e,t={},n=1e4){this.channel=r,this.event=e,this.payload=t,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,e){var t;return this._hasReceived(r)&&e(null===(t=this.receivedResp)||void 0===t?void 0:t.response),this.recHooks.push({status:r,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(r,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:e}){this.recHooks.filter(t=>t.status===r).forEach(t=>t.callback(e))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}class H{constructor(r,e){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const t=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(t.state,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=H.syncState(this.state,n,s,o),this.pendingDiffs.forEach(l=>{this.state=H.syncDiff(this.state,l,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(t.diff,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=H.syncDiff(this.state,n,s,o),a())}),this.onJoin((n,s,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:s,newPresences:o})}),this.onLeave((n,s,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,e,t,n){const s=this.cloneDeep(r),o=this.transformState(e),a={},l={};return this.map(s,(u,c)=>{o[u]||(l[u]=c)}),this.map(o,(u,c)=>{const d=s[u];if(d){const f=c.map(m=>m.presence_ref),g=d.map(m=>m.presence_ref),p=c.filter(m=>g.indexOf(m.presence_ref)<0),_=d.filter(m=>f.indexOf(m.presence_ref)<0);p.length>0&&(a[u]=p),_.length>0&&(l[u]=_)}else a[u]=c}),this.syncDiff(s,{joins:a,leaves:l},t,n)}static syncDiff(r,e,t,n){const{joins:s,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return t||(t=()=>{}),n||(n=()=>{}),this.map(s,(a,l)=>{var u;const c=null!==(u=r[a])&&void 0!==u?u:[];if(r[a]=this.cloneDeep(l),c.length>0){const d=r[a].map(g=>g.presence_ref),f=c.filter(g=>d.indexOf(g.presence_ref)<0);r[a].unshift(...f)}t(a,c,l)}),this.map(o,(a,l)=>{let u=r[a];if(!u)return;const c=l.map(d=>d.presence_ref);u=u.filter(d=>c.indexOf(d.presence_ref)<0),r[a]=u,n(a,u,l),0===u.length&&delete r[a]}),r}static map(r,e){return Object.getOwnPropertyNames(r).map(t=>e(t,r[t]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((e,t)=>{const n=r[t];return e[t]="metas"in n?n.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n,e},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var b=function(i){return i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange",i}(b||{});const Ue=(i,r,e={})=>{var t;const n=null!==(t=e.skipTypes)&&void 0!==t?t:[];return Object.keys(r).reduce((s,o)=>(s[o]=_t(o,i,r,n),s),{})},_t=(i,r,e,t)=>{const n=r.find(a=>a.name===i),s=null==n?void 0:n.type,o=e[i];return s&&!t.includes(s)?De(s,o):de(o)},De=(i,r)=>{if("_"===i.charAt(0)){const e=i.slice(1,i.length);return bt(r,e)}switch(i){case b.bool:return vt(r);case b.float4:case b.float8:case b.int2:case b.int4:case b.int8:case b.numeric:case b.oid:return yt(r);case b.json:case b.jsonb:return mt(r);case b.timestamp:return wt(r);default:return de(r)}},de=i=>i,vt=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},yt=i=>{if("string"==typeof i){const r=parseFloat(i);if(!Number.isNaN(r))return r}return i},mt=i=>{if("string"==typeof i)try{return JSON.parse(i)}catch(r){return console.log(`JSON parse error: ${r}`),i}return i},bt=(i,r)=>{if("string"!=typeof i)return i;const e=i.length-1;if("{"===i[0]&&"}"===i[e]){let s;const o=i.slice(1,e);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>De(r,a))}return i},wt=i=>"string"==typeof i?i.replace(" ","T"):i;class fe{constructor(r,e={config:{}},t){this.topic=r,this.params=e,this.socket=t,this.bindings={},this.state=x.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},e.config),this.timeout=this.socket.timeout,this.joinPush=new he(this,P.join,this.params,this.timeout),this.rejoinTimer=new Le(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=x.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=x.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=x.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=x.errored,this.rejoinTimer.scheduleTimeout())}),this._on(P.reply,{},(n,s)=>{this._trigger(this._replyEventName(s),n)}),this.presence=new H(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(r,e=this.timeout){var t,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:s,presence:o}}=this.params;this._onError(u=>r&&r("CHANNEL_ERROR",u)),this._onClose(()=>r&&r("CLOSED"));const a={},l={broadcast:s,presence:o,postgres_changes:null!==(n=null===(t=this.bindings.postgres_changes)||void 0===t?void 0:t.map(u=>u.filter))&&void 0!==n?n:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",({postgres_changes:u})=>{var c;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==u){const d=this.bindings.postgres_changes,f=null!==(c=null==d?void 0:d.length)&&void 0!==c?c:0,g=[];for(let p=0;p<f;p++){const _=d[p],{filter:{event:m,schema:A,table:S,filter:O}}=_,T=u&&u[p];if(!T||T.event!==m||T.schema!==A||T.table!==S||T.filter!==O)return this.unsubscribe(),void(r&&r("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));g.push(Object.assign(Object.assign({},_),{id:T.id}))}return this.bindings.postgres_changes=g,void(r&&r("SUBSCRIBED"))}r&&r("SUBSCRIBED")}).receive("error",u=>{r&&r("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{r&&r("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(r,e={}){var t=this;return(0,h.A)(function*(){return yield t.send({type:"presence",event:"track",payload:r},e.timeout||t.timeout)})()}untrack(r={}){var e=this;return(0,h.A)(function*(){return yield e.send({type:"presence",event:"untrack"},r)})()}on(r,e,t){return this._on(r,e,t)}send(r,e={}){var t=this;return(0,h.A)(function*(){var n,s;if(t._canPush()||"broadcast"!==r.type)return new Promise(o=>{var a,l,u;const c=t._push(r.type,r,e.timeout||t.timeout);"broadcast"===r.type&&!(null!==(u=null===(l=null===(a=t.params)||void 0===a?void 0:a.config)||void 0===l?void 0:l.broadcast)&&void 0!==u&&u.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("timeout",()=>o("timed out"))});{const{event:o,payload:a}=r,l={method:"POST",headers:{apikey:null!==(n=t.socket.apiKey)&&void 0!==n?n:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:t.subTopic,event:o,payload:a}]})};try{return(yield t._fetchWithTimeout(t.broadcastEndpointURL,l,null!==(s=e.timeout)&&void 0!==s?s:t.timeout)).ok?"ok":"error"}catch(u){return"AbortError"===u.name?"timed out":"error"}}})()}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=x.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(P.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(t=>{const n=new he(this,P.leave,{},r);n.receive("ok",()=>{e(),t("ok")}).receive("timeout",()=>{e(),t("timed out")}).receive("error",()=>{t("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}_broadcastEndpointURL(){let r=this.socket.endPoint;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")+"/api/broadcast"}_fetchWithTimeout(r,e,t){var n=this;return(0,h.A)(function*(){const s=new AbortController,o=setTimeout(()=>s.abort(),t),a=yield n.socket.fetch(r,Object.assign(Object.assign({},e),{signal:s.signal}));return clearTimeout(o),a})()}_push(r,e,t=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new he(this,r,e,t);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(r,e,t){return e}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,e,t){var n,s;const o=r.toLocaleLowerCase(),{close:a,error:l,leave:u,join:c}=P;if(t&&[a,l,u,c].indexOf(o)>=0&&t!==this._joinRef())return;let f=this._onMessage(o,e,t);if(e&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(g=>{var p,_,m;return"*"===(null===(p=g.filter)||void 0===p?void 0:p.event)||(null===(m=null===(_=g.filter)||void 0===_?void 0:_.event)||void 0===m?void 0:m.toLocaleLowerCase())===o}).map(g=>g.callback(f,t)):null===(s=this.bindings[o])||void 0===s||s.filter(g=>{var p,_,m,A,S,O;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in g){const T=g.id,N=null===(p=g.filter)||void 0===p?void 0:p.event;return T&&(null===(_=e.ids)||void 0===_?void 0:_.includes(T))&&("*"===N||(null==N?void 0:N.toLocaleLowerCase())===(null===(m=e.data)||void 0===m?void 0:m.type.toLocaleLowerCase()))}{const T=null===(S=null===(A=null==g?void 0:g.filter)||void 0===A?void 0:A.event)||void 0===S?void 0:S.toLocaleLowerCase();return"*"===T||T===(null===(O=null==e?void 0:e.event)||void 0===O?void 0:O.toLocaleLowerCase())}}return g.type.toLocaleLowerCase()===o}).map(g=>{if("object"==typeof f&&"ids"in f){const p=f.data,{schema:_,table:m,commit_timestamp:A,type:S,errors:O}=p;f=Object.assign(Object.assign({},{schema:_,table:m,commit_timestamp:A,eventType:S,new:{},old:{},errors:O}),this._getPayloadRecords(p))}g.callback(f,t)})}_isClosed(){return this.state===x.closed}_isJoined(){return this.state===x.joined}_isJoining(){return this.state===x.joining}_isLeaving(){return this.state===x.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,e,t){const n=r.toLocaleLowerCase(),s={type:n,filter:e,callback:t};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(r,e){const t=r.toLocaleLowerCase();return this.bindings[t]=this.bindings[t].filter(n=>{var s;return!((null===(s=n.type)||void 0===s?void 0:s.toLocaleLowerCase())===t&&fe.isEqual(n.filter,e))}),this}static isEqual(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(r[t]!==e[t])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(P.close,{},r)}_onError(r){this._on(P.error,{},e=>r(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=x.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const e={new:{},old:{}};return("INSERT"===r.type||"UPDATE"===r.type)&&(e.new=Ue(r.columns,r.record)),("UPDATE"===r.type||"DELETE"===r.type)&&(e.old=Ue(r.columns,r.old_record)),e}}const Tt=()=>{},Ot=typeof WebSocket<"u";class xt{constructor(r,e){var n,t=this;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=ht,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Tt,this.conn=null,this.sendBuffer=[],this.serializer=new pt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=o=>{let a;return a=o||(typeof fetch>"u"?(...l)=>Promise.resolve().then(w.bind(w,5286)).then(({default:u})=>u(...l)):fetch),(...l)=>a(...l)},this.endPoint=`${r}/${Ie.websocket}`,this.transport=null!=e&&e.transport?e.transport:null,null!=e&&e.params&&(this.params=e.params),null!=e&&e.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),null!=e&&e.timeout&&(this.timeout=e.timeout),null!=e&&e.logger&&(this.logger=e.logger),null!=e&&e.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const s=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.apikey;s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=null!=e&&e.reconnectAfterMs?e.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=null!=e&&e.encode?e.encode:(o,a)=>a(JSON.stringify(o)),this.decode=null!=e&&e.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Le((0,h.A)(function*(){t.disconnect(),t.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==e?void 0:e.fetch)}connect(){if(!this.conn){if(this.transport)return void(this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers}));if(Ot)return this.conn=new WebSocket(this._endPointURL()),void this.setupConnection();this.conn=new Et(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),w.e(3806).then(w.t.bind(w,3806,23)).then(({default:r})=>{this.conn=new r(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(r,e){this.conn&&(this.conn.onclose=function(){},r?this.conn.close(r,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(r){var e=this;return(0,h.A)(function*(){const t=yield r.unsubscribe();return 0===e.channels.length&&e.disconnect(),t})()}removeAllChannels(){var r=this;return(0,h.A)(function*(){const e=yield Promise.all(r.channels.map(t=>t.unsubscribe()));return r.disconnect(),e})()}log(r,e,t){this.logger(r,e,t)}connectionState(){switch(this.conn&&this.conn.readyState){case K.connecting:return q.Connecting;case K.open:return q.Open;case K.closing:return q.Closing;default:return q.Closed}}isConnected(){return this.connectionState()===q.Open}channel(r,e={config:{}}){const t=new fe(`realtime:${r}`,e,this);return this.channels.push(t),t}push(r){const{topic:e,event:t,payload:n,ref:s}=r,o=()=>{this.encode(r,a=>{var l;null===(l=this.conn)||void 0===l||l.send(a)})};this.log("push",`${e} ${t} (${s})`,n),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(r){this.accessToken=r,this.channels.forEach(e=>{r&&e.updateJoinPayload({access_token:r}),e.joinedOnce&&e._isJoined()&&e._push(P.access_token,{access_token:r})})}_makeRef(){let r=this.ref+1;return this.ref=r===this.ref?0:r,this.ref.toString()}_leaveOpenTopic(r){let e=this.channels.find(t=>t.topic===r&&(t._isJoined()||t._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${r}"`),e.unsubscribe())}_remove(r){this.channels=this.channels.filter(e=>e._joinRef()!==r._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(r){this.decode(r.data,e=>{let{topic:t,event:n,payload:s,ref:o}=e;(o&&o===this.pendingHeartbeatRef||n===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${n} ${o&&"("+o+")"||""}`,s),this.channels.filter(a=>a._isMember(t)).forEach(a=>a._trigger(n,s,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(r=>r())}_onConnClose(r){this.log("transport","close",r),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(r))}_onConnError(r){this.log("transport",r.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(r))}_triggerChanError(){this.channels.forEach(r=>r._trigger(P.error))}_appendParams(r,e){if(0===Object.keys(e).length)return r;const t=r.match(/\?/)?"&":"?";return`${r}${t}${new URLSearchParams(e)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_sendHeartbeat(){var r;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(r=this.conn)||void 0===r||r.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Et{constructor(r,e,t){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=K.connecting,this.send=()=>{},this.url=null,this.url=r,this.close=t.close}}class pe extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function k(i){return"object"==typeof i&&null!==i&&"__isStorageError"in i}class jt extends pe{constructor(r,e){super(r),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ne extends pe{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}}const Fe=i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(w.bind(w,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)};var M=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(c){try{u(t.next(c))}catch(d){o(d)}}function l(c){try{u(t.throw(c))}catch(d){o(d)}}function u(c){c.done?s(c.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(c.value).then(a,l)}u((t=t.apply(i,r||[])).next())})};const ge=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Rt=(i,r)=>M(void 0,void 0,void 0,function*(){const e=yield function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(c){try{u(t.next(c))}catch(d){o(d)}}function l(c){try{u(t.throw(c))}catch(d){o(d)}}function u(c){c.done?s(c.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(c.value).then(a,l)}u((t=t.apply(i,r||[])).next())})}(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(w.bind(w,5286))).Response:Response});i instanceof e?i.json().then(t=>{r(new jt(ge(t),i.status||500))}).catch(t=>{r(new Ne(ge(t),t))}):r(new Ne(ge(i),i))}),Ct=(i,r,e,t)=>{const n={method:i,headers:(null==r?void 0:r.headers)||{}};return"GET"===i?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))};function Z(i,r,e,t,n,s){return M(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(e,Ct(r,t,n,s)).then(l=>{if(!l.ok)throw l;return null!=t&&t.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Rt(l,a))})})}function _e(i,r,e,t){return M(this,void 0,void 0,function*(){return Z(i,"GET",r,e,t)})}function R(i,r,e,t,n){return M(this,void 0,void 0,function*(){return Z(i,"POST",r,t,n,e)})}function It(i,r,e,t,n){return M(this,void 0,void 0,function*(){return Z(i,"PUT",r,t,n,e)})}function qe(i,r,e,t,n){return M(this,void 0,void 0,function*(){return Z(i,"DELETE",r,t,n,e)})}var E=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(c){try{u(t.next(c))}catch(d){o(d)}}function l(c){try{u(t.throw(c))}catch(d){o(d)}}function u(c){c.done?s(c.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(c.value).then(a,l)}u((t=t.apply(i,r||[])).next())})};const Lt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Me={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ut{constructor(r,e={},t,n){this.url=r,this.headers=e,this.bucketId=t,this.fetch=Fe(n)}uploadOrUpdate(r,e,t,n){return E(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},Me),n),a=Object.assign(Object.assign({},this.headers),"POST"===r&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&t instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),s.append("",t)):typeof FormData<"u"&&t instanceof FormData?(s=t,s.append("cacheControl",o.cacheControl)):(s=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),c=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:r,body:s,headers:a},null!=o&&o.duplex?{duplex:o.duplex}:{})),d=yield c.json();return c.ok?{data:{path:l,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(s){if(k(s))return{data:null,error:s};throw s}})}upload(r,e,t){return E(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,e,t)})}uploadToSignedUrl(r,e,t,n){return E(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(r),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=Object.assign({upsert:Me.upsert},n),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",u.cacheControl)):(l=t,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:c}),f=yield d.json();return d.ok?{data:{path:s,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(k(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(r){return E(this,void 0,void 0,function*(){try{let e=this._getFinalPath(r);const t=yield R(this.fetch,`${this.url}/object/upload/sign/${e}`,{},{headers:this.headers}),n=new URL(this.url+t.url),s=n.searchParams.get("token");if(!s)throw new pe("No token returned by API");return{data:{signedUrl:n.toString(),path:r,token:s},error:null}}catch(e){if(k(e))return{data:null,error:e};throw e}})}update(r,e,t){return E(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,e,t)})}move(r,e){return E(this,void 0,void 0,function*(){try{return{data:yield R(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e},{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}copy(r,e){return E(this,void 0,void 0,function*(){try{return{data:{path:(yield R(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e},{headers:this.headers})).Key},error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}createSignedUrl(r,e,t){return E(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),s=yield R(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:e},null!=t&&t.transform?{transform:t.transform}:{}),{headers:this.headers});const o=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(n){if(k(n))return{data:null,error:n};throw n}})}createSignedUrls(r,e,t){return E(this,void 0,void 0,function*(){try{const n=yield R(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:r},{headers:this.headers}),s=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(n){if(k(n))return{data:null,error:n};throw n}})}download(r,e){return E(this,void 0,void 0,function*(){const n=typeof(null==e?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),o=s?`?${s}`:"";try{const a=this._getFinalPath(r);return{data:yield(yield _e(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(k(a))return{data:null,error:a};throw a}})}getPublicUrl(r,e){const t=this._getFinalPath(r),n=[],s=null!=e&&e.download?`download=${!0===e.download?"":e.download}`:"";""!==s&&n.push(s);const a=typeof(null==e?void 0:e.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==l&&n.push(l);let u=n.join("&");return""!==u&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${t}${u}`)}}}remove(r){return E(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(e){if(k(e))return{data:null,error:e};throw e}})}list(r,e,t){return E(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Lt),e),{prefix:r||""});return{data:yield R(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(k(n))return{data:null,error:n};throw n}})}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}}const Dt={"X-Client-Info":"storage-js/2.5.5"};var B=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(c){try{u(t.next(c))}catch(d){o(d)}}function l(c){try{u(t.throw(c))}catch(d){o(d)}}function u(c){c.done?s(c.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(c.value).then(a,l)}u((t=t.apply(i,r||[])).next())})};class Nt{constructor(r,e={},t){this.url=r,this.headers=Object.assign(Object.assign({},Dt),e),this.fetch=Fe(t)}listBuckets(){return B(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(k(r))return{data:null,error:r};throw r}})}getBucket(r){return B(this,void 0,void 0,function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(e){if(k(e))return{data:null,error:e};throw e}})}createBucket(r,e={public:!1}){return B(this,void 0,void 0,function*(){try{return{data:yield R(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}updateBucket(r,e){return B(this,void 0,void 0,function*(){try{return{data:yield It(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})}emptyBucket(r){return B(this,void 0,void 0,function*(){try{return{data:yield R(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(k(e))return{data:null,error:e};throw e}})}deleteBucket(r){return B(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(e){if(k(e))return{data:null,error:e};throw e}})}}class Ft extends Nt{constructor(r,e={},t){super(r,e,t)}from(r){return new Ut(this.url,this.headers,r,this.fetch)}}let W="";W=typeof Deno<"u"?"deno":typeof document<"u"?"web":typeof navigator<"u"&&"ReactNative"===navigator.product?"react-native":"node";const Mt={headers:{"X-Client-Info":`supabase-js-${W}/2.42.0`}},Bt={schema:"public"},Jt={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},zt={};const Wt=(i,r,e)=>{const t=(i=>{let r;return r=i||(typeof fetch>"u"?ce.default:fetch),(...e)=>r(...e)})(e),n=typeof Headers>"u"?ce.Headers:Headers;return(s,o)=>function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(c){try{u(t.next(c))}catch(d){o(d)}}function l(c){try{u(t.throw(c))}catch(d){o(d)}}function u(c){c.done?s(c.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(c.value).then(a,l)}u((t=t.apply(i,r||[])).next())})}(void 0,void 0,void 0,function*(){var a;const l=null!==(a=yield r())&&void 0!==a?a:i;let u=new n(null==o?void 0:o.headers);return u.has("apikey")||u.set("apikey",i),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),t(s,Object.assign(Object.assign({},o),{headers:u}))})},ve="X-Supabase-Api-Version",ze={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},j=()=>typeof document<"u",L={tested:!1,writable:!1},V=()=>{if(!j())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch{return!1}if(L.tested)return L.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),L.tested=!0,L.writable=!0}catch{L.tested=!0,L.writable=!1}return L.writable};function ye(i){const r={},e=new URL(i);if(e.hash&&"#"===e.hash[0])try{new URLSearchParams(e.hash.substring(1)).forEach((n,s)=>{r[s]=n})}catch{}return e.searchParams.forEach((t,n)=>{r[n]=t}),r}const Ge=i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(w.bind(w,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)},rr=i=>"object"==typeof i&&null!==i&&"status"in i&&"ok"in i&&"json"in i&&"function"==typeof i.json,Ke=function(){var i=(0,h.A)(function*(r,e,t){yield r.setItem(e,JSON.stringify(t))});return function(e,t,n){return i.apply(this,arguments)}}(),ee=function(){var i=(0,h.A)(function*(r,e){const t=yield r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}});return function(e,t){return i.apply(this,arguments)}}(),me=function(){var i=(0,h.A)(function*(r,e){yield r.removeItem(e)});return function(e,t){return i.apply(this,arguments)}}();class te{constructor(){this.promise=new te.promiseConstructor((r,e)=>{this.resolve=r,this.reject=e})}}function He(i){const e=i.split(".");if(3!==e.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");return JSON.parse(function nr(i){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t,n,s,o,a,l,u,e="",c=0;for(i=i.replace("-","+").replace("_","/");c<i.length;)o=r.indexOf(i.charAt(c++)),a=r.indexOf(i.charAt(c++)),l=r.indexOf(i.charAt(c++)),u=r.indexOf(i.charAt(c++)),t=o<<2|a>>4,n=(15&a)<<4|l>>2,s=(3&l)<<6|u,e+=String.fromCharCode(t),64!=l&&0!=n&&(e+=String.fromCharCode(n)),64!=u&&0!=s&&(e+=String.fromCharCode(s));return e}(e[1]))}function be(){return(be=(0,h.A)(function*(i){return yield new Promise(r=>{setTimeout(()=>r(null),i)})})).apply(this,arguments)}function or(i){return("0"+i.toString(16)).substr(-2)}function we(){return(we=(0,h.A)(function*(i){const e=(new TextEncoder).encode(i),t=yield crypto.subtle.digest("SHA-256",e),n=new Uint8Array(t);return Array.from(n).map(s=>String.fromCharCode(s)).join("")})).apply(this,arguments)}function Ae(){return Ae=(0,h.A)(function*(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const e=yield function lr(i){return we.apply(this,arguments)}(i);return function cr(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(e)}),Ae.apply(this,arguments)}function J(i,r){return ke.apply(this,arguments)}function ke(){return ke=(0,h.A)(function*(i,r,e=!1){const t=function ar(){const r=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let s=0;s<56;s++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(r),Array.from(r,or).join("")}();let n=t;e&&(n+="/PASSWORD_RECOVERY"),yield Ke(i,`${r}-code-verifier`,n);const s=yield function ur(i){return Ae.apply(this,arguments)}(t);return[s,t===s?"plain":"s256"]}),ke.apply(this,arguments)}te.promiseConstructor=Promise;const hr=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class Se extends Error{constructor(r,e,t){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=t}}function v(i){return"object"==typeof i&&null!==i&&"__isAuthError"in i}class fr extends Se{constructor(r,e,t){super(r,e,t),this.name="AuthApiError",this.status=e,this.code=t}}class We extends Se{constructor(r,e){super(r),this.name="AuthUnknownError",this.originalError=e}}class U extends Se{constructor(r,e,t,n){super(r,t,n),this.name=e,this.status=t}}class z extends U{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Te extends U{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class re extends U{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class ne extends U{constructor(r,e=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ve extends U{constructor(r,e=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Oe extends U{constructor(r,e){super(r,"AuthRetryableFetchError",e,void 0)}}function xe(i){return v(i)&&"AuthRetryableFetchError"===i.name}class Xe extends U{constructor(r,e,t){super(r,"AuthWeakPasswordError",e,"weak_password"),this.reasons=t}}const D=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),_r=[502,503,504];function Qe(i){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,h.A)(function*(i){var r;if(!rr(i))throw new Oe(D(i),0);if(_r.includes(i.status))throw new Oe(D(i),i.status);let e,t;try{e=yield i.json()}catch(s){throw new We(D(s),s)}const n=function dr(i){const r=i.headers.get(ve);if(!r||!r.match(hr))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}(i);if(n&&n.getTime()>=ze["2024-01-01"].timestamp&&"object"==typeof e&&e&&"string"==typeof e.code?t=e.code:"object"==typeof e&&e&&"string"==typeof e.error_code&&(t=e.error_code),t){if("weak_password"===t)throw new Xe(D(e),i.status,(null===(r=e.weak_password)||void 0===r?void 0:r.reasons)||[])}else if("object"==typeof e&&e&&"object"==typeof e.weak_password&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((s,o)=>s&&"string"==typeof o,!0))throw new Xe(D(e),i.status,e.weak_password.reasons);throw new fr(D(e),i.status||500,t)})).apply(this,arguments)}const vr=(i,r,e,t)=>{const n={method:i,headers:(null==r?void 0:r.headers)||{}};return"GET"===i?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))};function y(i,r,e,t){return je.apply(this,arguments)}function je(){return je=(0,h.A)(function*(i,r,e,t){var n;const s=Object.assign({},null==t?void 0:t.headers);s[ve]||(s[ve]=ze["2024-01-01"].name),null!=t&&t.jwt&&(s.Authorization=`Bearer ${t.jwt}`);const o=null!==(n=null==t?void 0:t.query)&&void 0!==n?n:{};null!=t&&t.redirectTo&&(o.redirect_to=t.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield function yr(i,r,e,t,n,s){return $e.apply(this,arguments)}(i,r,e+a,{headers:s,noResolveJson:null==t?void 0:t.noResolveJson},{},null==t?void 0:t.body);return null!=t&&t.xform?null==t?void 0:t.xform(l):{data:Object.assign({},l),error:null}}),je.apply(this,arguments)}function $e(){return($e=(0,h.A)(function*(i,r,e,t,n,s){const o=vr(r,t,n,s);let a;try{a=yield i(e,Object.assign(Object.assign({},o),{cache:"no-store"}))}catch(l){throw console.error(l),new Oe(D(l),0)}if(a.ok||(yield Qe(a)),null!=t&&t.noResolveJson)return a;try{return yield a.json()}catch(l){yield Qe(l)}})).apply(this,arguments)}function C(i){var r;let e=null;return function Ar(i){return i.access_token&&i.refresh_token&&i.expires_in}(i)&&(e=Object.assign({},i),i.expires_at||(e.expires_at=function er(i){return Math.round(Date.now()/1e3)+i}(i.expires_in))),{data:{session:e,user:null!==(r=i.user)&&void 0!==r?r:i},error:null}}function Ye(i){const r=C(i);return!r.error&&i.weak_password&&"object"==typeof i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&"string"==typeof i.weak_password.message&&i.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(r.data.weak_password=i.weak_password),r}function I(i){var r;return{data:{user:null!==(r=i.user)&&void 0!==r?r:i},error:null}}function mr(i){return{data:i,error:null}}function br(i){const{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:s}=i,o=function(i,r){var e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&r.indexOf(t)<0&&(e[t]=i[t]);if(null!=i&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(i);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(i,t[n])&&(e[t[n]]=i[t[n]])}return e}(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:s},user:Object.assign({},o)},error:null}}function wr(i){return i}class Sr{constructor({url:r="",headers:e={},fetch:t}){this.url=r,this.headers=e,this.fetch=Ge(t),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r,e="global"){var t=this;return(0,h.A)(function*(){try{return yield y(t.fetch,"POST",`${t.url}/logout?scope=${e}`,{headers:t.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(n){if(v(n))return{data:null,error:n};throw n}})()}inviteUserByEmail(r,e={}){var t=this;return(0,h.A)(function*(){try{return yield y(t.fetch,"POST",`${t.url}/invite`,{body:{email:r,data:e.data},headers:t.headers,redirectTo:e.redirectTo,xform:I})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}generateLink(r){var e=this;return(0,h.A)(function*(){try{const{options:t}=r,n=function(i,r){var e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&r.indexOf(t)<0&&(e[t]=i[t]);if(null!=i&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(i);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(i,t[n])&&(e[t[n]]=i[t[n]])}return e}(r,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=null==n?void 0:n.newEmail,delete s.newEmail),yield y(e.fetch,"POST",`${e.url}/admin/generate_link`,{body:s,headers:e.headers,xform:br,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(v(t))return{data:{properties:null,user:null},error:t};throw t}})()}createUser(r){var e=this;return(0,h.A)(function*(){try{return yield y(e.fetch,"POST",`${e.url}/admin/users`,{body:r,headers:e.headers,xform:I})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}})()}listUsers(r){var e=this;return(0,h.A)(function*(){var t,n,s,o,a,l,u;try{const c={nextPage:null,lastPage:0,total:0},d=yield y(e.fetch,"GET",`${e.url}/admin/users`,{headers:e.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==r?void 0:r.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(o=null===(s=null==r?void 0:r.perPage)||void 0===s?void 0:s.toString())&&void 0!==o?o:""},xform:wr});if(d.error)throw d.error;const f=yield d.json(),g=null!==(a=d.headers.get("x-total-count"))&&void 0!==a?a:0,p=null!==(u=null===(l=d.headers.get("link"))||void 0===l?void 0:l.split(","))&&void 0!==u?u:[];return p.length>0&&(p.forEach(_=>{const m=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),A=JSON.parse(_.split(";")[1].split("=")[1]);c[`${A}Page`]=m}),c.total=parseInt(g)),{data:Object.assign(Object.assign({},f),c),error:null}}catch(c){if(v(c))return{data:{users:[]},error:c};throw c}})()}getUserById(r){var e=this;return(0,h.A)(function*(){try{return yield y(e.fetch,"GET",`${e.url}/admin/users/${r}`,{headers:e.headers,xform:I})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}})()}updateUserById(r,e){var t=this;return(0,h.A)(function*(){try{return yield y(t.fetch,"PUT",`${t.url}/admin/users/${r}`,{body:e,headers:t.headers,xform:I})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}deleteUser(r,e=!1){var t=this;return(0,h.A)(function*(){try{return yield y(t.fetch,"DELETE",`${t.url}/admin/users/${r}`,{headers:t.headers,body:{should_soft_delete:e},xform:I})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}_listFactors(r){var e=this;return(0,h.A)(function*(){try{const{data:t,error:n}=yield y(e.fetch,"GET",`${e.url}/admin/users/${r.userId}/factors`,{headers:e.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(v(t))return{data:null,error:t};throw t}})()}_deleteFactor(r){var e=this;return(0,h.A)(function*(){try{return{data:yield y(e.fetch,"DELETE",`${e.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:e.headers}),error:null}}catch(t){if(v(t))return{data:null,error:t};throw t}})()}}const Tr={getItem:i=>V()?globalThis.localStorage.getItem(i):null,setItem:(i,r)=>{V()&&globalThis.localStorage.setItem(i,r)},removeItem:i=>{V()&&globalThis.localStorage.removeItem(i)}};function Ze(i={}){return{getItem:r=>i[r]||null,setItem:(r,e)=>{i[r]=e},removeItem:r=>{delete i[r]}}}const G={debug:!!(globalThis&&V()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class et extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class xr extends et{}function Er(i,r,e){return Pe.apply(this,arguments)}function Pe(){return Pe=(0,h.A)(function*(i,r,e){G.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,r);const t=new globalThis.AbortController;return r>0&&setTimeout(()=>{t.abort(),G.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},r),yield globalThis.navigator.locks.request(i,0===r?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:t.signal},function(){var n=(0,h.A)(function*(s){if(!s){if(0===r)throw G.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new xr(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(G.debug)try{const o=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield e()}G.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return yield e()}finally{G.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}});return function(s){return n.apply(this,arguments)}}())}),Pe.apply(this,arguments)}!function Or(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}();const jr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/2.63.0"},flowType:"implicit",debug:!1},X=3e4;function rt(i,r,e){return Re.apply(this,arguments)}function Re(){return(Re=(0,h.A)(function*(i,r,e){return yield e()})).apply(this,arguments)}const Pr=(()=>{class i{constructor(e){var n,s,t=this;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.insecureGetSessionWarningShown=!1,this.instanceID=i.nextInstanceID,i.nextInstanceID+=1,this.instanceID>0&&j()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},jr),e);if(this.logDebugMessages=!!o.debug,"function"==typeof o.debug&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Sr({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Ge(o.fetch),this.lock=o.lock||rt,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.lock=o.lock?o.lock:j()&&null!==(n=null==globalThis?void 0:globalThis.navigator)&&void 0!==n&&n.locks?Er:rt,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?o.storage?this.storage=o.storage:V()?this.storage=Tr:(this.memoryStorage={},this.storage=Ze(this.memoryStorage)):(this.memoryStorage={},this.storage=Ze(this.memoryStorage)),j()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",function(){var a=(0,h.A)(function*(l){t._debug("received broadcast notification from other tab or client",l),yield t._notifyAllSubscribers(l.data.event,l.data.session,!1)});return function(l){return a.apply(this,arguments)}}())}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (2.63.0) ${(new Date).toISOString()}`,...e),this}initialize(){var e=this;return(0,h.A)(function*(){return e.initializePromise||(e.initializePromise=(0,h.A)(function*(){return yield e._acquireLock(-1,(0,h.A)(function*(){return yield e._initialize()}))})()),yield e.initializePromise})()}_initialize(){var e=this;return(0,h.A)(function*(){try{const t=!!j()&&(yield e._isPKCEFlow());if(e._debug("#_initialize()","begin","is PKCE flow",t),t||e.detectSessionInUrl&&e._isImplicitGrantFlow()){const{data:n,error:s}=yield e._getSessionFromURL(t);if(s)return e._debug("#_initialize()","error detecting session from URL",s),"Identity is already linked"===(null==s?void 0:s.message)||"Identity is already linked to another user"===(null==s?void 0:s.message)||(yield e._removeSession()),{error:s};const{session:o,redirectType:a}=n;return e._debug("#_initialize()","detected session in URL",o,"redirect type",a),yield e._saveSession(o),setTimeout((0,h.A)(function*(){"recovery"===a?yield e._notifyAllSubscribers("PASSWORD_RECOVERY",o):yield e._notifyAllSubscribers("SIGNED_IN",o)}),0),{error:null}}return yield e._recoverAndRefresh(),{error:null}}catch(t){return v(t)?{error:t}:{error:new We("Unexpected error during initialization",t)}}finally{yield e._handleVisibilityChange(),e._debug("#_initialize()","end")}})()}signInAnonymously(e){var t=this;return(0,h.A)(function*(){var n,s,o;try{yield t._removeSession();const a=yield y(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{data:null!==(s=null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(o=null==e?void 0:e.options)||void 0===o?void 0:o.captchaToken}},xform:C}),{data:l,error:u}=a;if(u||!l)return{data:{user:null,session:null},error:u};const c=l.session,d=l.user;return l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(v(a))return{data:{user:null,session:null},error:a};throw a}})()}signUp(e){var t=this;return(0,h.A)(function*(){var n,s,o;try{let a;if(yield t._removeSession(),"email"in e){const{email:f,password:g,options:p}=e;let _=null,m=null;"pkce"===t.flowType&&([_,m]=yield J(t.storage,t.storageKey)),a=yield y(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,redirectTo:null==p?void 0:p.emailRedirectTo,body:{email:f,password:g,data:null!==(n=null==p?void 0:p.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null==p?void 0:p.captchaToken},code_challenge:_,code_challenge_method:m},xform:C})}else{if(!("phone"in e))throw new re("You must provide either an email or phone number and a password");{const{phone:f,password:g,options:p}=e;a=yield y(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{phone:f,password:g,data:null!==(s=null==p?void 0:p.data)&&void 0!==s?s:{},channel:null!==(o=null==p?void 0:p.channel)&&void 0!==o?o:"sms",gotrue_meta_security:{captcha_token:null==p?void 0:p.captchaToken}},xform:C})}}const{data:l,error:u}=a;if(u||!l)return{data:{user:null,session:null},error:u};const c=l.session,d=l.user;return l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(v(a))return{data:{user:null,session:null},error:a};throw a}})()}signInWithPassword(e){var t=this;return(0,h.A)(function*(){try{let n;if(yield t._removeSession(),"email"in e){const{email:a,password:l,options:u}=e;n=yield y(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{email:a,password:l,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken}},xform:Ye})}else{if(!("phone"in e))throw new re("You must provide either an email or phone number and a password");{const{phone:a,password:l,options:u}=e;n=yield y(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{phone:a,password:l,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken}},xform:Ye})}}const{data:s,error:o}=n;return o?{data:{user:null,session:null},error:o}:s&&s.session&&s.user?(s.session&&(yield t._saveSession(s.session),yield t._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:o}):{data:{user:null,session:null},error:new Te}}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOAuth(e){var t=this;return(0,h.A)(function*(){var n,s,o,a;return yield t._removeSession(),yield t._handleProviderSignIn(e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(o=e.options)||void 0===o?void 0:o.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})})()}exchangeCodeForSession(e){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,t._acquireLock(-1,(0,h.A)(function*(){return t._exchangeCodeForSession(e)}))})()}_exchangeCodeForSession(e){var t=this;return(0,h.A)(function*(){const n=yield ee(t.storage,`${t.storageKey}-code-verifier`),[s,o]=(null!=n?n:"").split("/"),{data:a,error:l}=yield y(t.fetch,"POST",`${t.url}/token?grant_type=pkce`,{headers:t.headers,body:{auth_code:e,code_verifier:s},xform:C});return yield me(t.storage,`${t.storageKey}-code-verifier`),l?{data:{user:null,session:null,redirectType:null},error:l}:a&&a.session&&a.user?(a.session&&(yield t._saveSession(a.session),yield t._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:null!=o?o:null}),error:l}):{data:{user:null,session:null,redirectType:null},error:new Te}})()}signInWithIdToken(e){var t=this;return(0,h.A)(function*(){yield t._removeSession();try{const{options:n,provider:s,token:o,access_token:a,nonce:l}=e,u=yield y(t.fetch,"POST",`${t.url}/token?grant_type=id_token`,{headers:t.headers,body:{provider:s,id_token:o,access_token:a,nonce:l,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:C}),{data:c,error:d}=u;return d?{data:{user:null,session:null},error:d}:c&&c.session&&c.user?(c.session&&(yield t._saveSession(c.session),yield t._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d}):{data:{user:null,session:null},error:new Te}}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOtp(e){var t=this;return(0,h.A)(function*(){var n,s,o,a,l;try{if(yield t._removeSession(),"email"in e){const{email:u,options:c}=e;let d=null,f=null;"pkce"===t.flowType&&([d,f]=yield J(t.storage,t.storageKey));const{error:g}=yield y(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{email:u,data:null!==(n=null==c?void 0:c.data)&&void 0!==n?n:{},create_user:null===(s=null==c?void 0:c.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},code_challenge:d,code_challenge_method:f},redirectTo:null==c?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:g}}if("phone"in e){const{phone:u,options:c}=e,{data:d,error:f}=yield y(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{phone:u,data:null!==(o=null==c?void 0:c.data)&&void 0!==o?o:{},create_user:null===(a=null==c?void 0:c.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},channel:null!==(l=null==c?void 0:c.channel)&&void 0!==l?l:"sms"}});return{data:{user:null,session:null,messageId:null==d?void 0:d.message_id},error:f}}throw new re("You must provide either an email or phone number.")}catch(u){if(v(u))return{data:{user:null,session:null},error:u};throw u}})()}verifyOtp(e){var t=this;return(0,h.A)(function*(){var n,s;try{let o,a;"email_change"!==e.type&&"phone_change"!==e.type&&(yield t._removeSession()),"options"in e&&(o=null===(n=e.options)||void 0===n?void 0:n.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:l,error:u}=yield y(t.fetch,"POST",`${t.url}/verify`,{headers:t.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:o,xform:C});if(u)throw u;if(!l)throw new Error("An error occurred on token verification.");const c=l.session,d=l.user;return null!=c&&c.access_token&&(yield t._saveSession(c),yield t._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(v(o))return{data:{user:null,session:null},error:o};throw o}})()}signInWithSSO(e){var t=this;return(0,h.A)(function*(){var n,s,o;try{yield t._removeSession();let a=null,l=null;return"pkce"===t.flowType&&([a,l]=yield J(t.storage,t.storageKey)),yield y(t.fetch,"POST",`${t.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(n=e.options)||void 0===n?void 0:n.redirectTo)&&void 0!==s?s:void 0}),null!==(o=null==e?void 0:e.options)&&void 0!==o&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:t.headers,xform:mr})}catch(a){if(v(a))return{data:null,error:a};throw a}})()}reauthenticate(){var e=this;return(0,h.A)(function*(){return yield e.initializePromise,yield e._acquireLock(-1,(0,h.A)(function*(){return yield e._reauthenticate()}))})()}_reauthenticate(){var e=this;return(0,h.A)(function*(){try{return yield e._useSession(function(){var t=(0,h.A)(function*(n){const{data:{session:s},error:o}=n;if(o)throw o;if(!s)throw new z;const{error:a}=yield y(e.fetch,"GET",`${e.url}/reauthenticate`,{headers:e.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}});return function(n){return t.apply(this,arguments)}}())}catch(t){if(v(t))return{data:{user:null,session:null},error:t};throw t}})()}resend(e){var t=this;return(0,h.A)(function*(){try{"email_change"!=e.type&&"phone_change"!=e.type&&(yield t._removeSession());const n=`${t.url}/resend`;if("email"in e){const{email:s,type:o,options:a}=e,{error:l}=yield y(t.fetch,"POST",n,{headers:t.headers,body:{email:s,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:l}}if("phone"in e){const{phone:s,type:o,options:a}=e,{data:l,error:u}=yield y(t.fetch,"POST",n,{headers:t.headers,body:{phone:s,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==l?void 0:l.message_id},error:u}}throw new re("You must provide either an email or phone number and a type")}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}getSession(){var e=this;return(0,h.A)(function*(){yield e.initializePromise;const t=yield e._acquireLock(-1,(0,h.A)(function*(){return e._useSession(function(){var n=(0,h.A)(function*(s){return s});return function(s){return n.apply(this,arguments)}}())}));return t.data&&e.storage.isServer&&(e.insecureGetSessionWarningShown||(console.warn("Using supabase.auth.getSession() is potentially insecure as it loads data directly from the storage medium (typically cookies) which may not be authentic. Prefer using supabase.auth.getUser() instead. To suppress this warning call supabase.auth.getUser() before you call supabase.auth.getSession()."),e.insecureGetSessionWarningShown=!0)),t})()}_acquireLock(e,t){var n=this;return(0,h.A)(function*(){n._debug("#_acquireLock","begin",e);try{if(n.lockAcquired){const s=n.pendingInLock.length?n.pendingInLock[n.pendingInLock.length-1]:Promise.resolve(),o=(0,h.A)(function*(){return yield s,yield t()})();return n.pendingInLock.push((0,h.A)(function*(){try{yield o}catch{}})()),o}return yield n.lock(`lock:${n.storageKey}`,e,(0,h.A)(function*(){n._debug("#_acquireLock","lock acquired for storage key",n.storageKey);try{n.lockAcquired=!0;const s=t();for(n.pendingInLock.push((0,h.A)(function*(){try{yield s}catch{}})()),yield s;n.pendingInLock.length;){const o=[...n.pendingInLock];yield Promise.all(o),n.pendingInLock.splice(0,o.length)}return yield s}finally{n._debug("#_acquireLock","lock released for storage key",n.storageKey),n.lockAcquired=!1}}))}finally{n._debug("#_acquireLock","end")}})()}_useSession(e){var t=this;return(0,h.A)(function*(){t._debug("#_useSession","begin");try{const n=yield t.__loadSession();return yield e(n)}finally{t._debug("#_useSession","end")}})()}__loadSession(){var e=this;return(0,h.A)(function*(){e._debug("#__loadSession()","begin"),e.lockAcquired||e._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const n=yield ee(e.storage,e.storageKey);if(e._debug("#getSession()","session from storage",n),null!==n&&(e._isValidSession(n)?t=n:(e._debug("#getSession()","session from storage is not valid"),yield e._removeSession())),!t)return{data:{session:null},error:null};const s=!!t.expires_at&&t.expires_at<=Date.now()/1e3;if(e._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(e.storage.isServer){let l=t.user;delete t.user,Object.defineProperty(t,"user",{enumerable:!0,get:()=>(t.__suppressUserWarning||console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l),set:u=>{l=u}})}return{data:{session:t},error:null}}const{session:o,error:a}=yield e._callRefreshToken(t.refresh_token);return a?{data:{session:null},error:a}:{data:{session:o},error:null}}finally{e._debug("#__loadSession()","end")}})()}getUser(e){var t=this;return(0,h.A)(function*(){if(e)return yield t._getUser(e);yield t.initializePromise;const n=yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._getUser()}));return n.data&&t.storage.isServer&&(t.insecureGetSessionWarningShown=!0),n})()}_getUser(e){var t=this;return(0,h.A)(function*(){try{return e?yield y(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:e,xform:I}):yield t._useSession(function(){var n=(0,h.A)(function*(s){var o,a;const{data:l,error:u}=s;if(u)throw u;return yield y(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:null!==(a=null===(o=l.session)||void 0===o?void 0:o.access_token)&&void 0!==a?a:void 0,xform:I})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}updateUser(e,t={}){var n=this;return(0,h.A)(function*(){return yield n.initializePromise,yield n._acquireLock(-1,(0,h.A)(function*(){return yield n._updateUser(e,t)}))})()}_updateUser(e,t={}){var n=this;return(0,h.A)(function*(){try{return yield n._useSession(function(){var s=(0,h.A)(function*(o){const{data:a,error:l}=o;if(l)throw l;if(!a.session)throw new z;const u=a.session;let c=null,d=null;"pkce"===n.flowType&&null!=e.email&&([c,d]=yield J(n.storage,n.storageKey));const{data:f,error:g}=yield y(n.fetch,"PUT",`${n.url}/user`,{headers:n.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:d}),jwt:u.access_token,xform:I});if(g)throw g;return u.user=f.user,yield n._saveSession(u),yield n._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}});return function(o){return s.apply(this,arguments)}}())}catch(s){if(v(s))return{data:{user:null},error:s};throw s}})()}_decodeJWT(e){return He(e)}setSession(e){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._setSession(e)}))})()}_setSession(e){var t=this;return(0,h.A)(function*(){try{if(!e.access_token||!e.refresh_token)throw new z;const n=Date.now()/1e3;let s=n,o=!0,a=null;const l=He(e.access_token);if(l.exp&&(s=l.exp,o=s<=n),o){const{session:u,error:c}=yield t._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!u)return{data:{user:null,session:null},error:null};a=u}else{const{data:u,error:c}=yield t._getUser(e.access_token);if(c)throw c;a={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:s-n,expires_at:s},yield t._saveSession(a),yield t._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(n){if(v(n))return{data:{session:null,user:null},error:n};throw n}})()}refreshSession(e){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._refreshSession(e)}))})()}_refreshSession(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o;if(!e){const{data:u,error:c}=s;if(c)throw c;e=null!==(o=u.session)&&void 0!==o?o:void 0}if(null==e||!e.refresh_token)throw new z;const{session:a,error:l}=yield t._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}_getSessionFromURL(e){var t=this;return(0,h.A)(function*(){try{if(!j())throw new ne("No browser detected.");if("implicit"===t.flowType&&!t._isImplicitGrantFlow())throw new ne("Not a valid implicit grant flow url.");if("pkce"==t.flowType&&!e)throw new Ve("Not a valid PKCE flow url.");const n=ye(window.location.href);if(e){if(!n.code)throw new Ve("No code detected.");const{data:T,error:N}=yield t._exchangeCodeForSession(n.code);if(N)throw N;const nt=new URL(window.location.href);return nt.searchParams.delete("code"),window.history.replaceState(window.history.state,"",nt.toString()),{data:{session:T.session,redirectType:null},error:null}}if(n.error||n.error_description||n.error_code)throw new ne(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:o,access_token:a,refresh_token:l,expires_in:u,expires_at:c,token_type:d}=n;if(!(a&&u&&l&&d))throw new ne("No session defined in URL");const f=Math.round(Date.now()/1e3),g=parseInt(u);let p=f+g;c&&(p=parseInt(c));const _=p-f;1e3*_<=X&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${_}s, should have been closer to ${g}s`);const m=p-g;f-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,p,f):f-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",m,p,f);const{data:A,error:S}=yield t._getUser(a);if(S)throw S;const O={provider_token:s,provider_refresh_token:o,access_token:a,expires_in:g,expires_at:p,refresh_token:l,token_type:d,user:A.user};return window.location.hash="",t._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:O,redirectType:n.type},error:null}}catch(n){if(v(n))return{data:{session:null,redirectType:null},error:n};throw n}})()}_isImplicitGrantFlow(){const e=ye(window.location.href);return!(!j()||!e.access_token&&!e.error_description)}_isPKCEFlow(){var e=this;return(0,h.A)(function*(){const t=ye(window.location.href),n=yield ee(e.storage,`${e.storageKey}-code-verifier`);return!(!t.code||!n)})()}signOut(e={scope:"global"}){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._signOut(e)}))})()}_signOut({scope:e}={scope:"global"}){var t=this;return(0,h.A)(function*(){return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o;const{data:a,error:l}=s;if(l)return{error:l};const u=null===(o=a.session)||void 0===o?void 0:o.access_token;if(u){const{error:c}=yield t.admin.signOut(u,e);if(c&&(!function pr(i){return v(i)&&"AuthApiError"===i.name}(c)||404!==c.status&&401!==c.status))return{error:c}}return"others"!==e&&(yield t._removeSession(),yield me(t.storage,`${t.storageKey}-code-verifier`),yield t._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}});return function(s){return n.apply(this,arguments)}}())})()}onAuthStateChange(e){var t=this;const n=function tr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const r=16*Math.random()|0;return("x"==i?r:3&r|8).toString(16)})}(),s={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(0,h.A)(function*(){yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){t._emitInitialSession(n)}))})(),{data:{subscription:s}}}_emitInitialSession(e){var t=this;return(0,h.A)(function*(){return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o,a;try{const{data:{session:l},error:u}=s;if(u)throw u;yield null===(o=t.stateChangeEmitters.get(e))||void 0===o?void 0:o.callback("INITIAL_SESSION",l),t._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){yield null===(a=t.stateChangeEmitters.get(e))||void 0===a?void 0:a.callback("INITIAL_SESSION",null),t._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}});return function(s){return n.apply(this,arguments)}}())})()}resetPasswordForEmail(e,t={}){var n=this;return(0,h.A)(function*(){let s=null,o=null;"pkce"===n.flowType&&([s,o]=yield J(n.storage,n.storageKey,!0));try{return yield y(n.fetch,"POST",`${n.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:n.headers,redirectTo:t.redirectTo})}catch(a){if(v(a))return{data:null,error:a};throw a}})()}getUserIdentities(){var e=this;return(0,h.A)(function*(){var t;try{const{data:n,error:s}=yield e.getUser();if(s)throw s;return{data:{identities:null!==(t=n.user.identities)&&void 0!==t?t:[]},error:null}}catch(n){if(v(n))return{data:null,error:n};throw n}})()}linkIdentity(e){var t=this;return(0,h.A)(function*(){var n;try{const{data:s,error:o}=yield t._useSession(function(){var a=(0,h.A)(function*(l){var u,c,d,f,g;const{data:p,error:_}=l;if(_)throw _;const m=yield t._getUrlForProvider(`${t.url}/user/identities/authorize`,e.provider,{redirectTo:null===(u=e.options)||void 0===u?void 0:u.redirectTo,scopes:null===(c=e.options)||void 0===c?void 0:c.scopes,queryParams:null===(d=e.options)||void 0===d?void 0:d.queryParams,skipBrowserRedirect:!0});return yield y(t.fetch,"GET",m,{headers:t.headers,jwt:null!==(g=null===(f=p.session)||void 0===f?void 0:f.access_token)&&void 0!==g?g:void 0})});return function(l){return a.apply(this,arguments)}}());if(o)throw o;return j()&&!(null!==(n=e.options)&&void 0!==n&&n.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(v(s))return{data:{provider:e.provider,url:null},error:s};throw s}})()}unlinkIdentity(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o,a;const{data:l,error:u}=s;if(u)throw u;return yield y(t.fetch,"DELETE",`${t.url}/user/identities/${e.identity_id}`,{headers:t.headers,jwt:null!==(a=null===(o=l.session)||void 0===o?void 0:o.access_token)&&void 0!==a?a:void 0})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}})()}_refreshAccessToken(e){var t=this;return(0,h.A)(function*(){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;t._debug(n,"begin");try{const s=Date.now();return yield function ir(i,r){return new Promise((t,n)=>{(0,h.A)(function*(){for(let s=0;s<1/0;s++)try{const o=yield i(s);if(!r(s,null,o))return void t(o)}catch(o){if(!r(s,o))return void n(o)}})()})}(function(){var o=(0,h.A)(function*(a){return yield function sr(i){return be.apply(this,arguments)}(200*a),t._debug(n,"refreshing attempt",a),yield y(t.fetch,"POST",`${t.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:t.headers,xform:C})});return function(a){return o.apply(this,arguments)}}(),(o,a,l)=>l&&l.error&&xe(l.error)&&Date.now()+200*(o+1)-s<X)}catch(s){if(t._debug(n,"error",s),v(s))return{data:{session:null,user:null},error:s};throw s}finally{t._debug(n,"end")}})()}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){var n=this;return(0,h.A)(function*(){const s=yield n._getUrlForProvider(`${n.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return n._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),j()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})()}_recoverAndRefresh(){var e=this;return(0,h.A)(function*(){var t;const n="#_recoverAndRefresh()";e._debug(n,"begin");try{const s=yield ee(e.storage,e.storageKey);if(e._debug(n,"session from storage",s),!e._isValidSession(s))return e._debug(n,"session is not valid"),void(null!==s&&(yield e._removeSession()));const o=Math.round(Date.now()/1e3),a=(null!==(t=s.expires_at)&&void 0!==t?t:1/0)<o+10;if(e._debug(n,`session has${a?"":" not"} expired with margin of 10s`),a){if(e.autoRefreshToken&&s.refresh_token){const{error:l}=yield e._callRefreshToken(s.refresh_token);l&&(console.error(l),xe(l)||(e._debug(n,"refresh failed with a non-retryable error, removing the session",l),yield e._removeSession()))}}else yield e._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return e._debug(n,"error",s),void console.error(s)}finally{e._debug(n,"end")}})()}_callRefreshToken(e){var t=this;return(0,h.A)(function*(){var n,s;if(!e)throw new z;if(t.refreshingDeferred)return t.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;t._debug(o,"begin");try{t.refreshingDeferred=new te;const{data:a,error:l}=yield t._refreshAccessToken(e);if(l)throw l;if(!a.session)throw new z;yield t._saveSession(a.session),yield t._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const u={session:a.session,error:null};return t.refreshingDeferred.resolve(u),u}catch(a){if(t._debug(o,"error",a),v(a)){const l={session:null,error:a};return xe(a)||(yield t._removeSession(),yield t._notifyAllSubscribers("SIGNED_OUT",null)),null===(n=t.refreshingDeferred)||void 0===n||n.resolve(l),l}throw null===(s=t.refreshingDeferred)||void 0===s||s.reject(a),a}finally{t.refreshingDeferred=null,t._debug(o,"end")}})()}_notifyAllSubscribers(e,t,n=!0){var s=this;return(0,h.A)(function*(){const o=`#_notifyAllSubscribers(${e})`;s._debug(o,"begin",t,`broadcast = ${n}`);try{s.broadcastChannel&&n&&s.broadcastChannel.postMessage({event:e,session:t});const a=[],l=Array.from(s.stateChangeEmitters.values()).map(function(){var u=(0,h.A)(function*(c){try{yield c.callback(e,t)}catch(d){a.push(d)}});return function(c){return u.apply(this,arguments)}}());if(yield Promise.all(l),a.length>0){for(let u=0;u<a.length;u+=1)console.error(a[u]);throw a[0]}}finally{s._debug(o,"end")}})()}_saveSession(e){var t=this;return(0,h.A)(function*(){t._debug("#_saveSession()",e),yield Ke(t.storage,t.storageKey,e)})()}_removeSession(){var e=this;return(0,h.A)(function*(){e._debug("#_removeSession()"),yield me(e.storage,e.storageKey)})()}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&j()&&null!=window&&window.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){var e=this;return(0,h.A)(function*(){yield e._stopAutoRefresh(),e._debug("#_startAutoRefresh()");const t=setInterval(()=>e._autoRefreshTokenTick(),X);e.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():typeof Deno<"u"&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout((0,h.A)(function*(){yield e.initializePromise,yield e._autoRefreshTokenTick()}),0)})()}_stopAutoRefresh(){var e=this;return(0,h.A)(function*(){e._debug("#_stopAutoRefresh()");const t=e.autoRefreshTicker;e.autoRefreshTicker=null,t&&clearInterval(t)})()}startAutoRefresh(){var e=this;return(0,h.A)(function*(){e._removeVisibilityChangedCallback(),yield e._startAutoRefresh()})()}stopAutoRefresh(){var e=this;return(0,h.A)(function*(){e._removeVisibilityChangedCallback(),yield e._stopAutoRefresh()})()}_autoRefreshTokenTick(){var e=this;return(0,h.A)(function*(){e._debug("#_autoRefreshTokenTick()","begin");try{yield e._acquireLock(0,(0,h.A)(function*(){try{const t=Date.now();try{return yield e._useSession(function(){var n=(0,h.A)(function*(s){const{data:{session:o}}=s;if(!o||!o.refresh_token||!o.expires_at)return void e._debug("#_autoRefreshTokenTick()","no session");const a=Math.floor((1e3*o.expires_at-t)/X);e._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${X}ms, refresh threshold is 3 ticks`),a<=3&&(yield e._callRefreshToken(o.refresh_token))});return function(s){return n.apply(this,arguments)}}())}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{e._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof et))throw t;e._debug("auto refresh token tick lock not available")}})()}_handleVisibilityChange(){var e=this;return(0,h.A)(function*(){if(e._debug("#_handleVisibilityChange()"),!j()||null==window||!window.addEventListener)return e.autoRefreshToken&&e.startAutoRefresh(),!1;try{e.visibilityChangedCallback=(0,h.A)(function*(){return yield e._onVisibilityChanged(!1)}),null==window||window.addEventListener("visibilitychange",e.visibilityChangedCallback),yield e._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})()}_onVisibilityChanged(e){var t=this;return(0,h.A)(function*(){const n=`#_onVisibilityChanged(${e})`;t._debug(n,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(t.autoRefreshToken&&t._startAutoRefresh(),e||(yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){"visible"===document.visibilityState?yield t._recoverAndRefresh():t._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&t.autoRefreshToken&&t._stopAutoRefresh()})()}_getUrlForProvider(e,t,n){var s=this;return(0,h.A)(function*(){const o=[`provider=${encodeURIComponent(t)}`];if(null!=n&&n.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),null!=n&&n.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===s.flowType){const[a,l]=yield J(s.storage,s.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(l)}`});o.push(u.toString())}if(null!=n&&n.queryParams){const a=new URLSearchParams(n.queryParams);o.push(a.toString())}return null!=n&&n.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${o.join("&")}`})()}_unenroll(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o;const{data:a,error:l}=s;return l?{data:null,error:l}:yield y(t.fetch,"DELETE",`${t.url}/factors/${e.factorId}`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}})()}_enroll(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o,a;const{data:l,error:u}=s;if(u)return{data:null,error:u};const{data:c,error:d}=yield y(t.fetch,"POST",`${t.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:t.headers,jwt:null===(o=null==l?void 0:l.session)||void 0===o?void 0:o.access_token});return d?{data:null,error:d}:(!(null===(a=null==c?void 0:c.totp)||void 0===a)&&a.qr_code&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}})()}_verify(e){var t=this;return(0,h.A)(function*(){return t._acquireLock(-1,(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o;const{data:a,error:l}=s;if(l)return{data:null,error:l};const{data:u,error:c}=yield y(t.fetch,"POST",`${t.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token});return c?{data:null,error:c}:(yield t._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),yield t._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:c})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}}))})()}_challenge(e){var t=this;return(0,h.A)(function*(){return t._acquireLock(-1,(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(s){var o;const{data:a,error:l}=s;return l?{data:null,error:l}:yield y(t.fetch,"POST",`${t.url}/factors/${e.factorId}/challenge`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}}))})()}_challengeAndVerify(e){var t=this;return(0,h.A)(function*(){const{data:n,error:s}=yield t._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield t._verify({factorId:e.factorId,challengeId:n.id,code:e.code})})()}_listFactors(){var e=this;return(0,h.A)(function*(){const{data:{user:t},error:n}=yield e.getUser();if(n)return{data:null,error:n};const s=(null==t?void 0:t.factors)||[],o=s.filter(a=>"totp"===a.factor_type&&"verified"===a.status);return{data:{all:s,totp:o},error:null}})()}_getAuthenticatorAssuranceLevel(){var e=this;return(0,h.A)(function*(){return e._acquireLock(-1,(0,h.A)(function*(){return yield e._useSession(function(){var t=(0,h.A)(function*(n){var s,o;const{data:{session:a},error:l}=n;if(l)return{data:null,error:l};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const u=e._decodeJWT(a.access_token);let c=null;u.aal&&(c=u.aal);let d=c;return(null!==(o=null===(s=a.user.factors)||void 0===s?void 0:s.filter(p=>"verified"===p.status))&&void 0!==o?o:[]).length>0&&(d="aal2"),{data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:u.amr||[]},error:null}});return function(n){return t.apply(this,arguments)}}())}))})()}}return i.nextInstanceID=0,i})();class Rr extends Pr{constructor(r){super(r)}}class Ir{constructor(r,e,t){var n,s,o,a,l,u,c,d;if(this.supabaseUrl=r,this.supabaseKey=e,!r)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const f=function Vt(i){return i.replace(/\/$/,"")}(r);this.realtimeUrl=`${f}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${f}/auth/v1`,this.storageUrl=`${f}/storage/v1`,this.functionsUrl=`${f}/functions/v1`;const g=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,_=function Xt(i,r){const{db:e,auth:t,realtime:n,global:s}=i,{db:o,auth:a,realtime:l,global:u}=r;return{db:Object.assign(Object.assign({},o),e),auth:Object.assign(Object.assign({},a),t),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},u),s)}}(null!=t?t:{},{db:Bt,realtime:zt,auth:Object.assign(Object.assign({},Jt),{storageKey:g}),global:Mt});this.storageKey=null!==(s=null===(n=_.auth)||void 0===n?void 0:n.storageKey)&&void 0!==s?s:"",this.headers=null!==(a=null===(o=_.global)||void 0===o?void 0:o.headers)&&void 0!==a?a:{},this.auth=this._initSupabaseAuthClient(null!==(l=_.auth)&&void 0!==l?l:{},this.headers,null===(u=_.global)||void 0===u?void 0:u.fetch),this.fetch=Wt(e,this._getAccessToken.bind(this),null===(c=_.global)||void 0===c?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},_.realtime)),this.rest=new ue(`${f}/rest/v1`,{headers:this.headers,schema:null===(d=_.db)||void 0===d?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new it(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ft(this.storageUrl,this.headers,this.fetch)}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,e;return function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(c){try{u(t.next(c))}catch(d){o(d)}}function l(c){try{u(t.throw(c))}catch(d){o(d)}}function u(c){c.done?s(c.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(c.value).then(a,l)}u((t=t.apply(i,r||[])).next())})}(this,void 0,void 0,function*(){const{data:t}=yield this.auth.getSession();return null!==(e=null===(r=t.session)||void 0===r?void 0:r.access_token)&&void 0!==e?e:null})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,storageKey:s,flowType:o,debug:a},l,u){return new Rr({url:this.authUrl,headers:Object.assign(Object.assign({},{Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`}),l),storageKey:s,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,flowType:o,debug:a,fetch:u})}_initRealtimeClient(r){return new xt(this.realtimeUrl,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},null==r?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(r,e,t){"TOKEN_REFRESHED"!==r&&"SIGNED_IN"!==r||this.changedAccessToken===t?"SIGNED_OUT"===r&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=t?t:null),this.changedAccessToken=t)}}const Lr=(i,r,e)=>new Ir(i,r,e)}}]);