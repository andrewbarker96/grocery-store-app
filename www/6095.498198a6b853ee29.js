"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6095],{6095:(A,f,l)=>{l.r(f),l.d(f,{LoginPageModule:()=>C});var y=l(177),u=l(4341),i=l(4488),h=l(9858),c=l(467),e=l(4438),v=l(9492),w=l(4412),b=l(5312);let k=(()=>{var r;class a{constructor(t){this.router=t,this.currentUser=new w.t(null),this.supabase=(0,v.UU)(b.c.supabaseUrl,b.c.supabaseKey),this.supabase.auth.onAuthStateChange((n,o)=>{"SIGNED_IN"===n||"TOKEN_REFRESHED"===n?(console.log("SET USER"),this.currentUser.next((null==o?void 0:o.user)||!1)):this.currentUser.next(!1)}),this.loadUser()}loadUser(){var t=this;return(0,c.A)(function*(){var n;if(t.currentUser.value)return;const o=yield t.supabase.auth.getUser();null!=o&&null!==(n=o.data)&&void 0!==n&&n.user?t.currentUser.next(o.data.user):t.currentUser.next(!1)})()}signUp(t){return this.supabase.auth.signUp(t)}signIn(t){return this.supabase.auth.signInWithPassword(t)}sendPwReset(t){return this.supabase.auth.resetPasswordForEmail(t)}signOut(){var t=this;return(0,c.A)(function*(){yield t.supabase.auth.signOut(),t.router.navigateByUrl("/",{replaceUrl:!0})})()}getCurrentUser(){return this.currentUser.asObservable()}getCurrentUserId(){return this.currentUser.value?this.currentUser.value.id:null}signInWithEmail(t){return this.supabase.auth.signInWithOtp({email:t})}}return(r=a).\u0275fac=function(t){return new(t||r)(e.KVO(h.Ix))},r.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),a})();function P(r,a){1&r&&(e.j41(0,"ion-note",17),e.EFF(1,"Please insert your email"),e.k0s())}function U(r,a){1&r&&(e.j41(0,"ion-note",17),e.EFF(1,"Please insert your password"),e.k0s())}const F=[{path:"",component:(()=>{var r;class a{constructor(t,n,o,s,d){this.fb=t,this.authService=n,this.loadingController=o,this.alertController=s,this.router=d,this.credentials=this.fb.nonNullable.group({email:["",u.k0.required],password:["",u.k0.required]}),this.authService.getCurrentUser().subscribe(m=>{m&&this.router.navigateByUrl("/groups",{replaceUrl:!0})})}get email(){return this.credentials.controls.email}get password(){return this.credentials.controls.password}login(){var t=this;return(0,c.A)(function*(){const n=yield t.loadingController.create();yield n.present(),t.authService.signIn(t.credentials.getRawValue()).then(function(){var o=(0,c.A)(function*(s){yield n.dismiss(),s.error&&t.showAlert("Login failed",s.error.message)});return function(s){return o.apply(this,arguments)}}())})()}showAlert(t,n){var o=this;return(0,c.A)(function*(){yield(yield o.alertController.create({header:t,message:n,buttons:["OK"]})).present()})()}forgotPw(){var t=this;return(0,c.A)(function*(){var o;yield(yield t.alertController.create({header:"Receive a new password",message:"Please insert your email",inputs:[{type:"email",name:"email"}],buttons:[{text:"Cancel",role:"cancel"},{text:"Reset password",handler:(o=(0,c.A)(function*(s){const d=yield t.loadingController.create();yield d.present();const{error:p}=yield t.authService.sendPwReset(s.email);yield d.dismiss(),p?t.showAlert("Failed",p.message):t.showAlert("Success","Please check your emails for further instructions!")}),function(d){return o.apply(this,arguments)})}]})).present()})()}getMagicLink(){var t=this;return(0,c.A)(function*(){var o;yield(yield t.alertController.create({header:"Get a Magic Link",message:"We will send you a link to magically log in!",inputs:[{type:"email",name:"email"}],buttons:[{text:"Cancel",role:"cancel"},{text:"Get Magic Link",handler:(o=(0,c.A)(function*(s){const d=yield t.loadingController.create();yield d.present();const{error:p}=yield t.authService.signInWithEmail(s.email);yield d.dismiss(),p?t.showAlert("Failed",p.message):t.showAlert("Success","Please check your emails for further instructions!")}),function(d){return o.apply(this,arguments)})}]})).present()})()}}return(r=a).\u0275fac=function(t){return new(t||r)(e.rXU(u.ok),e.rXU(k),e.rXU(i.Xi),e.rXU(i.hG),e.rXU(h.Ix))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-login"]],decls:33,vars:4,consts:[["color","primary"],["scrollY","false"],[3,"ngSubmit","formGroup"],["position","stacked"],["type","email","inputmode","email","placeholder","Email","formControlName","email"],["slot","error",4,"ngIf"],["type","password","placeholder","Password","formControlName","password"],["type","submit","expand","block","strong","true",3,"disabled"],[1,"ion-margin-top"],["type","button","expand","block","color","primary","fill","outline","routerLink","register"],["name","person-outline","slot","start"],["type","button","expand","block","color","secondary",3,"click"],["name","key-outline","slot","start"],["type","button","expand","block","color","tertiary",3,"click"],["name","mail-outline","slot","start"],["type","button","expand","block","color","warning","routerLink","groups"],["name","arrow-forward","slot","start"],["slot","error"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Grocery Store App"),e.k0s()()(),e.j41(4,"ion-content",1)(5,"ion-card")(6,"ion-card-content")(7,"form",2),e.bIt("ngSubmit",function(){return n.login()}),e.j41(8,"ion-item")(9,"ion-label",3),e.EFF(10,"Your Email"),e.k0s(),e.nrm(11,"ion-input",4),e.DNE(12,P,2,0,"ion-note",5),e.k0s(),e.j41(13,"ion-item")(14,"ion-label",3),e.EFF(15,"Password"),e.k0s(),e.nrm(16,"ion-input",6),e.DNE(17,U,2,0,"ion-note",5),e.k0s(),e.j41(18,"ion-button",7),e.EFF(19,"Sign in"),e.k0s(),e.j41(20,"div",8)(21,"ion-button",9),e.nrm(22,"ion-icon",10),e.EFF(23," Create Account "),e.k0s(),e.j41(24,"ion-button",11),e.bIt("click",function(){return n.forgotPw()}),e.nrm(25,"ion-icon",12),e.EFF(26," Forgot password? "),e.k0s(),e.j41(27,"ion-button",13),e.bIt("click",function(){return n.getMagicLink()}),e.nrm(28,"ion-icon",14),e.EFF(29," Get a Magic Link "),e.k0s(),e.j41(30,"ion-button",15),e.nrm(31,"ion-icon",16),e.EFF(32," Start without account "),e.k0s()()()()()()),2&t&&(e.R7$(7),e.Y8G("formGroup",n.credentials),e.R7$(5),e.Y8G("ngIf",(n.email.dirty||n.email.touched)&&n.email.errors),e.R7$(5),e.Y8G("ngIf",(n.password.dirty||n.password.touched)&&n.password.errors),e.R7$(),e.Y8G("disabled",!n.credentials.valid))},dependencies:[y.bT,u.qT,u.BC,u.cb,i.Jm,i.b_,i.I9,i.W9,i.eU,i.iq,i.$w,i.uz,i.he,i.JI,i.BC,i.ai,i.Gw,i.N7,h.Wk,u.j4,u.JD],styles:["ion-content[_ngcontent-%COMP%]{--padding-top: 20%;--padding-start: 5%;--padding-end: 5%;--background: linear-gradient(rgba(0, 0, 0, .6), rgba(0, 0, 0, .7)), url(https://images.unsplash.com/photo-1607349913338-fca6f7fc42d0?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D) no-repeat}"]}),a})()}];let L=(()=>{var r;class a{}return(r=a).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[h.iI.forChild(F),h.iI]}),a})(),C=(()=>{var r;class a{}return(r=a).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[y.MD,u.YN,i.bv,L,u.X1]}),a})()}}]);